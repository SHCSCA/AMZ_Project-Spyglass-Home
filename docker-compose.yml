version: '3.8'

x-environment-defaults: &env_defaults
  VITE_API_BASE_URL: ${VITE_API_BASE_URL-https://shcamz.xyz:8081}
  APP_VERSION: ${APP_VERSION-latest}

services:
  frontend:
    build:
      context: .
      args:
        # 构建时注入（静态编译进 bundle）
        VITE_API_BASE_URL: ${VITE_API_BASE_URL-https://shcamz.xyz:8081}
        APP_BUILD_TIME: ${APP_BUILD_TIME-$(date +%Y%m%d%H%M%S)}
    image: spyglass-frontend:latest
    ports:
      # 将宿主机 FRONTEND_PORT (默认 8082) 映射到容器 80 (Nginx)
      - "${FRONTEND_PORT-8082}:80"
    environment: *env_defaults
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "-O", "-", "http://localhost/" ]
      interval: 30s
      timeout: 5s
      retries: 3
    networks:
      - spyglass-net
    profiles: ["frontend"]
    labels:
      com.spyglass.role: frontend
      com.spyglass.api-base: ${VITE_API_BASE_URL-https://shcamz.xyz:8081}
    depends_on: []
    # 如果需要让 Nginx 直接代理 /api 到后端，可在此扩展 backend 服务并替换 nginx.conf
    # volumes:
    #   - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro

networks:
  spyglass-net:
    driver: bridge
