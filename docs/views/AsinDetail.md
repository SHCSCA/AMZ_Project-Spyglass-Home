# ASIN Detail View 视图规范

## 目标
为单个 ASIN 提供历史趋势分析（价格/BSR/库存）以及相关告警、差评与内容变更（Diff）。

## 核心功能需求
| 编号 | 描述 | 优先级 |
|------|------|--------|
| F-UI-401 | 顶部信息卡：基本属性 + 概览指标 | P0 |
| F-UI-402 | 历史图表：价格 / BSR / 库存 | P0 |
| F-UI-403 | 范围切换：7d / 30d / 90d | P0 |
| F-UI-404 | 告警 Tab：`GET /api/asin/{id}/alerts` | P1 |
| F-UI-405 | 差评 Tab：`GET /api/asin/{id}/reviews?rating=negative` | P1 |
| F-UI-406 | 内容 Diff Tab（标题/五点/A+） | P2 |
| F-UI-407 | 分页差评与告警 | P1 |
| F-UI-408 | 告警过滤（类型/时间） | P1 |

## 顶部信息区域
展示：ASIN、昵称、站点、当前价格、最新 BSR、库存、品牌、分组、平均评分、评论总数。

## 历史数据接口
```
GET /api/asin/{id}/history?range=30d&page={page}&size={size}
```
响应示例：
```
{
  "items": [
     { "snapshotAt": "2025-11-01T10:00:00Z", "price": 19.99, "bsr": 12345, "inventory": 50 },
     ...
  ]
}
```

## 图表规范
| 图表 | 数据源字段 | 展示形式 | 说明 |
|------|-----------|---------|------|
| 价格折线 | price | 折线 + 平滑 + area 渐变 | 标注最大/最小/最新点 |
| BSR折线 | bsr | 折线 | 可收缩 dataZoom |
| 库存折线 | inventory | 折线 | 缺失时显示“暂无库存数据” |

## Tabs 区域
- Alerts：复用全局告警卡片样式；支持分页与类型过滤。
- Negative Reviews：评分（Rate）+ 日期 + 评论全文；分页切换。
- Diff (占位)：后端暂未实现时隐藏或显示“功能即将上线”。

## 交互与状态
- 切换范围立即请求新数据；保持所选范围在 URL query 中。
- 图表 resize 自适应；卸载时释放 ECharts 实例。
- 告警/评论分页与过滤参数进入依赖数组触发请求。

## 性能策略
- 图表数据量过大时可做抽样（例如 > 1000 点）。
- 分页拉取历史（如果后端支持）避免一次性全部加载。

## 错误与边界
| 场景 | 行为 |
|------|------|
| 历史数据请求失败 | 显示错误组件 + 重试按钮 |
| 告警为空 | 显示“暂无告警”占位 |
| 差评为空 | 显示“暂无差评”占位 |
| Diff 未实现 | 显示功能占位提示 |

## 后续扩展
- 时间范围支持自定义起止日期。
- 图表导出 PNG / CSV。
- 评论关键词高亮与情感标注。
- 告警趋势聚合图（条形图）。
